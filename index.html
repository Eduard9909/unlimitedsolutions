<style>
    .main-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 50;
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(0, 255, 0, 0.1);
        background: rgba(0, 0, 0, 0.4);
    }

    .header-logo {
        width: 48px;
        height: 48px;
        filter: drop-shadow(0 0 8px #0f0);
        transition: all 0.3s ease;
    }

    #matrixCanvas {
        position: fixed;
        top: 0;
        left: 0;
        z-index: -1;
    }

    .content-wrapper {
        margin-top: 120px;
        position: relative;
        z-index: 20;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: calc(100vh - 120px);
    }

    .matrix-input {
        background: rgba(0, 30, 0, 0.2) !important;
        border: 1px solid #0f03 !important;
        color: #0f0 !important;
        font-family: 'Courier New', monospace;
        transition: all 0.3s;
        backdrop-filter: blur(2px);
    }

    .matrix-input:focus {
        border: 1px solid #0f0 !important;
        box-shadow: 0 0 12px rgba(0, 255, 0, 0.1) !important;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 100;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: rgba(0, 30, 0, 0.9);
        border: 1px solid #0f0;
        padding: 16px;
        max-width: 90%;
        width: 100%;
        border-radius: 8px;
    }

    .feature-button {
        transition: all 0.3s ease;
        border: 2px solid #0f0 !important; /* Brighter and slightly thicker border */
    }

    .feature-button:hover {
        background-color: rgba(0, 255, 0, 0.1) !important;
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
    }

    .submit-button {
        transition: all 0.3s ease;
        border: 2px solid #0f0 !important; /* Brighter and slightly thicker border */
    }

    .submit-button:hover {
        background-color: rgba(0, 255, 0, 0.1) !important;
        transform: scale(1.02);
        box-shadow: 0 0 12px rgba(0, 255, 0, 0.3);
    }

    .modal-button {
        transition: all 0.3s ease;
        border: 1px solid #0f0; /* Brighter border for modal buttons */
    }

    .modal-button:hover {
        background-color: rgba(0, 255, 0, 0.1) !important;
        transform: scale(1.05);
        box-shadow: 0 0 8px rgba(0, 255, 0, 0.2); /* Added subtle shadow on hover */
    }

    @keyframes subtleFlash {
        0% { box-shadow: 0 0 0 rgba(0, 255, 0, 0); }
        50% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
        100% { box-shadow: 0 0 0 rgba(0, 255, 0, 0); }
    }

    .flash-on-load {
        animation: subtleFlash 1s ease-in-out;
    }

    @media (max-width: 640px) {
        .main-header {
            padding: 8px;
        }

        .content-wrapper {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        .header-logo {
            width: 40px;
            height: 40px;
        }

        .user-greeting {
            font-size: 0.75rem;
        }

        .matrix-input {
            font-size: 0.875rem;
        }

        .modal-content {
            padding: 12px;
        }
    }
</style>
<header class="main-header">
    <div class="container mx-auto px-4 py-2 flex items-center justify-between">
        <svg class="header-logo" viewBox="0 0 100 100">
            <text x="50" y="70" font-size="50" text-anchor="middle" fill="#0f0" font-family="M PLUS Rounded 1c, sans-serif" font-weight="bold">US</text>
        </svg>

        <div class="user-greeting font-mono text-right">
            <div class="text-green-500 text-xs">ACTIVE CONNECTION</div>
            <div class="text-green-400 text-[10px]">
                <div class="truncate">IP: <span id="userIP">...</span></div>
                <div class="truncate">LOC: <span id="userLocation">...</span></div>
                <div class="truncate">WEATHER: <span id="userWeather">...</span></div>
            </div>
        </div>
    </div>
</header>

<main class="content-wrapper">
    <div class="container mx-auto px-4 py-6 ">
        <div class="max-w-xl mx-auto bg-black/70 backdrop-blur-lg p-4 border border-white/20">
            <h2 class="text-lg sm:text-2xl mb-4 font-mono text-green-500 text-center overflow-hidden">
                <span id="typingText"></span>
            </h2>

            <div class="grid grid-cols-1 gap-3 mb-4 text-center"> {/* Adjusted to single column for the remaining button */}
                <button id="statusBtn" class="feature-button bg-black/20 text-green-500 p-2 text-xs sm:text-sm font-mono text-center">
                    SYSTEM STATUS
                </button>
                {/* Cost Calculator Button Removed */}
            </div>

            <form id="mainForm" action="https://formspree.io/f/mqapjaog" method="POST">
                <div class="space-y-4 text-center">
                    <div>
                        <label class="block text-green-500/80 mb-1 text-xs sm:text-sm font-mono">
                            ENTER FULL NAME
                        </label>
                        <input type="text" name="name" class="matrix-input w-full text-sm text-center placeholder:text-center" placeholder="John Doe" required>
                    </div>
                    <div>
                        <label class="block text-green-500/80 mb-1 text-xs sm:text-sm font-mono">
                            PRIMARY EMAIL
                        </label>
                        <input type="email" name="email" id="emailInput" class="matrix-input w-full text-sm text-center placeholder:text-center" placeholder="user@domain.com" required>
                    </div>
                    <div>
                        <label class="block text-green-500/80 mb-1 text-xs sm:text-sm font-mono">
                            SERVICE REQUEST
                        </label>
                        <textarea name="message" class="matrix-input w-full h-20 text-sm text-center placeholder:text-center" placeholder="Please explain how we can help you with your IT needs." required></textarea>
                    </div>
                    {/* Note Section Removed */}
                    <div class="flex space-x-2">
                        <button type="submit" class="submit-button flash-on-load flex-1 bg-black/20 text-green-500 p-3 text-xs sm:text-sm font-mono">
                            INITIATE ENCRYPTED MESSAGE
                        </button>
                        <button type="button" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/eduard-unlimitedsolutions/how-can-we-assist'});return false;" class="submit-button flash-on-load flex-1 bg-black/20 text-green-500 p-3 text-xs sm:text-sm font-mono">
                            Schedule Online Meeting
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</main>

<div class="fixed bottom-0 left-0 right-0 bg-black/95 backdrop-blur-xl z-50 p-2 border-t border-white/10">
    <div class="container mx-auto flex justify-between items-center text-xs">
        <div class="flex items-center space-x-2 font-mono">
            <div id="systemTime" class="text-white truncate"></div>
        </div>
        <div class="text-white font-mono text-center">Created by Eduard and AI</div>
        <div class="flex space-x-2 font-mono">
            <div id="liveClock" class="text-green-500"></div>
            <div class="text-white sm:block hidden">STATUS: SECURE</div>
        </div>
    </div>
</div>

<div id="statusModal" class="modal">
    <div class="modal-content">
        <h3 class="text-green-500 font-mono mb-3 text-sm sm:text-base">SYSTEM STATUS</h3>
        <div id="statusOutput" class="font-mono text-green-400 text-xs sm:text-sm"></div>
        <button id="statusClose" class="modal-button mt-3 bg-black/20 text-green-500 p-2 w-full font-mono text-xs sm:text-sm">CLOSE</button> {/* Added bg and padding like other modal buttons for consistency */}
    </div>
</div>

<audio class="hidden" id="keyboardSound">
    <source src="https://www.soundjay.com/buttons/button-35.mp3" type="audio/mpeg">
</audio>

<script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
<script>
    // Matrix Effect
    let matrixCanvas, ctx, chars, fontSize, columns, drops;
    const specialWords = ["GOOGLE", "OPENAI", "HELLO WORLD", "BINARY", "EDUARD", "EDDIE", "TRUST IN"];

    function initMatrix() {
        matrixCanvas = document.getElementById('matrixCanvas');
        ctx = matrixCanvas.getContext('2d');
        resizeMatrix();
        chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*';
        requestAnimationFrame(drawMatrix);
    }

    function resizeMatrix() {
        matrixCanvas.width = window.innerWidth;
        matrixCanvas.height = window.innerHeight;
        fontSize = window.innerWidth < 640 ? 10 : 12;
        columns = Math.floor(matrixCanvas.width / fontSize);
        drops = Array(columns).fill(0);
    }

    function drawMatrix() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
        ctx.fillStyle = '#0f0';
        ctx.font = fontSize + 'px monospace';

        if(Math.random() < 0.02) {
            const word = specialWords[Math.floor(Math.random() * specialWords.length)];
            const x = Math.random() * (matrixCanvas.width - word.length * fontSize);
            ctx.fillText(word, x, 20);
        }

        for(let i = 0; i < drops.length; i++) {
            const char = chars[Math.floor(Math.random() * chars.length)];
            const x = i * fontSize;
            const y = drops[i] * fontSize;

            ctx.fillText(char, x, y);
            if(y > matrixCanvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i] += 0.5; // Slower drop speed
        }
        requestAnimationFrame(drawMatrix);
    }

    // IP, Location, Timezone, and Weather Detection
    async function detectUser() {
        // Try Geolocation API first
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                let city = 'Unknown', country = 'Unknown';
                try {
                    const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
                    if (geoRes.ok) {
                        const geoData = await geoRes.json();
                        city = geoData.address.city || geoData.address.town || geoData.address.village || geoData.address.hamlet || 'Unknown';
                        country = geoData.address.country || 'Unknown';
                    }
                } catch (e) { /* Ignore reverse geocoding errors */ }
                
                let ip = 'Unknown';
                try {
                    const ipRes = await fetch('https://api.ipify.org?format=json');
                    if (ipRes.ok) {
                        const ipData = await ipRes.json();
                        ip = ipData.ip || 'Unknown';
                    }
                } catch (e) { /* Ignore IP fetch errors */ }

                document.getElementById('userIP').textContent = ip;
                document.getElementById('userLocation').textContent = `${city}, ${country}`;
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Africa/Johannesburg';
                updateTime(timezone);
                await fetchWeather(lat, lon);
            }, async (error) => {
                await detectUserByIP();
            });
        } else {
            await detectUserByIP();
        }
    }

    async function detectUserByIP() {
        const ipApis = [
            'https://api.ipify.org?format=json', // Note: This API only returns IP
            'https://ipapi.co/json/', // A good free tier alternative
            'http://ip-api.com/json/?fields=query,city,country,lat,lon,timezone'
            // 'https://ipwho.is/' // Often requires API key for full details
        ];
        let ip, city, country, lat, lon, timezone = 'Africa/Johannesburg';

        for (const apiUrl of ipApis) {
            try {
                const response = await fetch(apiUrl, { headers: { 'User-Agent': 'Mozilla/5.0' } });
                if (!response.ok) throw new Error(`Network response was not ok for ${apiUrl}`);
                const data = await response.json();

                ip = data.ip || data.query || ip; // Persist IP if already found
                city = data.city || city;
                country = data.country_name || data.country || country;
                lat = data.latitude || data.lat || lat;
                lon = data.longitude || data.lon || lon;
                timezone = data.timezone || timezone;

                if (ip && city && country && lat !== undefined && lon !== undefined && timezone) {
                     // If we got all necessary details from an API, break
                    if (apiUrl !== 'https://api.ipify.org?format=json' || (ip && city && country)) break;
                }
            } catch (error) {
                console.error(`Error with API ${apiUrl}:`, error);
            }
        }
        // If ipify was the only one that worked, we might still be missing some data
        if (!city || !country || lat === undefined || lon === undefined) {
            console.warn("Could not reliably determine full location details via IP.");
            // Use defaults or best effort
            city = city || 'Unknown';
            country = country || 'Unknown';
            lat = lat || 0; // Default to 0,0 or a known fallback
            lon = lon || 0;
        }


        document.getElementById('userIP').textContent = ip || 'Unknown';
        document.getElementById('userLocation').textContent = `${city}, ${country}`;
        updateTime(timezone); // timezone will be default or from a successful API call
        if (lat !== undefined && lon !== undefined && (lat !==0 || lon !== 0)) { // Avoid fetching weather for 0,0 if it's a fallback
             await fetchWeather(lat, lon);
        } else {
            document.getElementById('userWeather').textContent = 'Unavailable';
        }
    }

    async function fetchWeather(lat, lon) {
        try {
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weathercode`);
            if (!response.ok) throw new Error('Weather API response was not ok');
            const data = await response.json();
            const temp = data.current.temperature_2m;
    
            const weatherCode = data.current.weathercode;
            const weatherDesc = getWeatherDescription(weatherCode);
            document.getElementById('userWeather').textContent = `${temp}°C, ${weatherDesc}`;
        } catch (error) {
            console.error('Error fetching weather:', error);
            document.getElementById('userWeather').textContent = 'Error';
        }
    }

    function getWeatherDescription(code) {
        const weatherCodes = {
            0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
            45: 'Fog', 48: 'Depositing rime fog',
            51: 'Light drizzle', 53: 'Moderate drizzle', 55: 'Dense drizzle',
            61: 'Light rain', 63: 'Moderate rain', 65: 'Heavy rain',
            71: 'Light snow', 73: 'Moderate snow', 75: 'Heavy snow',
            80: 'Light showers', 81: 'Moderate showers', 82: 'Heavy showers',
            95: 'Thunderstorm', 96: 'Thunderstorm, light hail', 99: 'Thunderstorm, heavy hail'
        };
        return weatherCodes[code] || 'Unknown';
    }

    function updateTime(timezone) {
        setInterval(() => {
            const now = new Date();
            const options = { timeZone: timezone, hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const dateOptions = { timeZone: timezone, year: 'numeric', month: 'short', day: '2-digit' };
            try {
                document.getElementById('liveClock').textContent = now.toLocaleTimeString('en-US', options);
                document.getElementById('systemTime').textContent = now.toLocaleDateString('en-US', dateOptions);
            } catch (error) {
                console.error('Error updating time:', error);
                document.getElementById('liveClock').textContent = 'Error';
                document.getElementById('systemTime').textContent = 'Error';
            }
        }, 1000);
    }

    // Typing Effect
    let currentMessage = 0;
    const messages = ["Let us know how we can help?"]; // Original message, as requested for other functions to work as is.

    function typeText() {
        const text = messages[currentMessage];
        let index = 0;
        const typingElement = document.getElementById('typingText');
        typingElement.textContent = ''; // Clear before typing

        function type() {
            if(index < text.length) {
                typingElement.textContent += text.charAt(index);
                index++;
                setTimeout(type, 50);
            } else {
                setTimeout(resetTyping, 2000);
            }
        }
        type();
    }

    function resetTyping() {
        // No need to cycle messages if there's only one
        // currentMessage = (currentMessage + 1) % messages.length;
        typeText();
    }

    // Sound Effects for Email Input
    const keyboardSound = document.getElementById('keyboardSound');
    const emailInput = document.getElementById('emailInput');
    emailInput.addEventListener('keydown', () => {
        if (keyboardSound.readyState >= 2) { // Ensure sound is loaded enough to play
            keyboardSound.currentTime = 0;
            keyboardSound.play().catch(e => console.error("Error playing sound:", e));
        }
    });

    // Form Handling
    document.getElementById('mainForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const button = form.querySelector('button[type="submit"]');
        button.disabled = true;
        button.textContent = 'ENCRYPTING...';

        try {
            const response = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'Accept': 'application/json' }
            });

            if(response.ok) {
                window.location.href = 'http://unlimitedsolutions.xyz/thanks.html';
            } else {
                response.json().then(data => {
                    if (data.errors) {
                        alert('Submission error: ' + data.errors.map(error => error.message).join(", "));
                    } else {
                        alert('Transmission failed. Please try again.');
                    }
                }).catch(() => {
                     alert('Transmission failed and could not parse error. Please try again.');
                });
            }
        } catch (error) {
            alert('Network error. Please check your connection.');
        } finally {
            button.disabled = false;
            button.textContent = 'INITIATE ENCRYPTED MESSAGE';
        }
    });

    // System Status
    const statusModal = document.getElementById('statusModal');
    const statusOutput = document.getElementById('statusOutput');
    const statusBtn = document.getElementById('statusBtn');
    const statusClose = document.getElementById('statusClose');

    statusBtn.addEventListener('click', async () => {
        statusModal.style.display = 'flex';
        statusOutput.textContent = 'Checking system status...';
        try {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1000)); 
            const now = new Date();
            const lastCheckedTime = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            const lastCheckedDate = now.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: '2-digit'});
            statusOutput.innerHTML = `All systems operational.<br>Uptime: 99.9%<br>Last checked: ${lastCheckedDate}, ${lastCheckedTime}`;
        } catch(e) { // Changed variable name from error to e
            statusOutput.textContent = 'Unable to fetch status. Please try again.';
        }
    });

    statusClose.addEventListener('click', () => {
        statusModal.style.display = 'none';
    });

    // Cost Calculator JavaScript Removed

    // Initialize
    function init() {
        initMatrix();
        typeText();
        detectUser();
        window.addEventListener('resize', resizeMatrix);
    }

    // Ensure DOM is fully loaded before initializing
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init(); // DOMContentLoaded has already fired
    }
</script>
